<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/morris.js/0.5.1/morris.css">
<script src="//omnipotent.net/jquery.sparkline/2.1.2/jquery.sparkline.min.js"></script>

<%= content_tag :div, "", id: "one_month_data", data: {trades: trades_chart_data(1.month.ago) } %>

<div class="row">
    <div class="col-lg-6 col-md-8">
        <div class="panel">
            <div class="panel-heading">
                <div class="panel-control"></div>
                <h3 class="panel-title"><%= I18n.t('dashboard_open_trades') %></h3>
            </div>
            <div class="panel-body">
                <div class="pad-btm form-inline">
                    <div class="col-sm-6 table-toolbar-left">
                        <%= link_to new_dashboard_path, remote: true,  :data => { :toggle => 'modal', :target => 'myModal' } do %>
                          <button class="btn btn-purple btn-labeled fa fa-plus"><%= I18n.t('dashboard_button_trades') %></button>
                        <% end %>                        
                    </div>
                    <div class="col-sm-6 table-toolbar-right"></div>
                </div>
                <div id='trades'>
                    <%= render 'trade' %>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">                         
                <div id="trade-form" ></div>
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div>

    <div class="col-lg-6 col-md-4">
        <div class="row">
            <div class="col-lg-6">
                <div class="panel panel-mint panel-colorful">
                    <div class="pad-all media" style="text-align: center;">
                        <div class="row">
                            <div class="col-lg-5">
                                <div class="media-left">
                                    <span class="icon-wrap icon-wrap-xs">
                                        <i class="glyphicon glyphicon-send fa-2x"></i>
                                    </span>
                                </div>
                                <div class="media-body">
                                    <p class="h3 text-thin media-heading">
                                        <span id="lbl-today-performance"></span>
                                    </p>
                                    <small class="text-uppercase"><%= I18n.t('dashboard_success_rate_today') %></small>
                                </div>
                            </div>
                            <div class="col-lg-7">
                                <div id="today-performance-chart" style="height:120px"></div>
                            </div>
                        </div>                        
                    </div>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="row">
                    <div class="col-lg-6">
                        <div class="panel panel-purple panel-colorful">
                            <div class="pad-all media" style="text-align: center;">
                                <div class="media-left">
                                    <span class="icon-wrap icon-wrap-xs">
                                        <i class="glyphicon glyphicon-usd fa-2x"></i>
                                    </span>
                                </div>
                                <div class="media-body">
                                    <p class="h3 text-thin media-heading">
                                        <span id="lbl-today-profit-real"></span>
                                    </p>
                                    <span id="lbl-today-profit-demo"></span>
                                    <small class="text-uppercase"><%= I18n.t('dashboard_profit_today') %></small>
                                </div>                
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="panel panel-purple panel-colorful">
                            <div class="pad-all media" style="text-align: center;">
                                <div class="media-left">
                                    <span class="icon-wrap icon-wrap-xs">
                                        <i class="glyphicon glyphicon-briefcase fa-2x"></i>
                                    </span>
                                </div>
                                <div class="media-body">
                                    <p class="h3 text-thin media-heading">
                                        <span id="lbl-balance"><!--<%= @total_balance %>-->34,676</span>
                                    </p>
                                    <small class="text-uppercase"><%= I18n.t('dashboard_account_balance') %></small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>
<div class="row">
    <div class="panel">
        <div class="panel-heading">
            <div class="panel-control"></div>
            <h3 class="panel-title"><%= I18n.t('dashboard_last_30_day_performance') %></h3>
        </div>
        <div class="panel-body">
            <div id="month-performance-chart" style="height: 212px; position: relative; -webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></div>
        </div>
    </div>
</div>

<!-- /.row -->
<!--div class="row">
    <div class="col-lg-3">
        <div class="panel">
            <div class="panel-heading">
                <div class="panel-control">
                    <%= link_to new_dashboard_path, remote: true,  :data => { :toggle => 'modal', :target => 'myModal' } do %>
                      <button class="btn btn-default btn-xs"><%= I18n.t('dashboard_button_trades') %></button>
                    <% end %>
                </div>
                <h3>
                    <%= I18n.t('dashboard_open_trades') %>
                </h3>
            </div>
            <div class="panel-body">
                <div class="row">
                    <div class="col-lg-12">
                        <div id=''>

                        </div>
                    </div>
                </div>                  
            </div>
        </div>
    </div>
    <div class="col-lg-6">
        <div class="panel">
            <div class="panel-heading">
                <h3>
                    <%= I18n.t('dashboard_week_performance') %>
                </h3>
            </div>
            <div style="overflow:hidden">
                <div id="morris-chart-network" class="morris-full-content" style="position: relative; -webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
                </div>
            </div>
            <div class="panel-body bg-primary" style="position:relative;z-index:2">
                <div class="row">
                    <div class="col-lg-6">
                        <div class="row">
                            <div class="col-xs-8">
                                <div class="pad-ver media">
                                    <div class="media-left">
                                        <span class="icon-wrap icon-wrap-xs">
                                            <i class="fa fa-cloud fa-2x"></i>
                                        </span>
                                    </div>
                                </div>
                                <div class="media-body">
                                    <p class="h3 text-thin media-heading">30%</p>
                                    <small class="text-uppercase">Server Load</small>
                                </div>
                            </div>
                            <div class="col-xs-4">
                                <div class="text-center">
                                    <span class="text-3x text-thin">43</span>
                                    <p>User Online</p>
                                </div>
                            </div>
                        </div>
                        <div class="mar-ver">
                            <small class="pad-btm">
                                <em>* Lorem ipsum dolor sit amet, consectetuer adipiscing elit, sed diam nonummy nibh euismod tincidunt ut laoreet dolore magna aliquam erat volutpat. Ut wisi enim ad minim veniam.</em>
                            </small>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <ul class="list-group bg-trans mar-no">
                            <li class="list-group-item">
                                <div id="demo-chart-visitors" class="pull-right"></div>
                                Visitators
                            </li>
                            <li class="list-group-item">
                                <div id="demo-chart-bounce-rate" class="pull-right"></div>
                                Bounce rate
                            </li>
                            <li class="list-group-item">
                                <span class="badge badge-success">11</span>
                                Today Sales
                            </li>
                            <li class="list-group-item">
                                <span class="badge badge-warning">20</span>
                                Broken list found
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-lg-3">


        <div class="panel">
            <div class="panel-heading">
                <div class="panel-control">
                </div>
                <h3>
                    <%= I18n.t('dashboard_today_performance') %>
                </h3>
            </div>

            <div class="panel-body">
             <div class="row">
                <div class="col-sm-6 col-lg-6">
                    <div classs="panel panel-success panel-colorful text-center">
                        <div class="panel-body">

                        </div>
                        <div class="bg-light pad-ver">
                            <h4 class="mar-no text-thin">
                                 <%= I18n.t('dashboard_effective') %> 
                            </h4>
                        </div>
                    </div>
                </div>
                <div class="col-sm-6 col-lg-6">
                    <div classs="panel panel-success panel-colorful text-center">
                        <div class="panel-body">
                            <div id="demo-sparkline-line"></div>
                        </div>
                        <div class="bg-light pad-ver">
                            <h4 class="mar-no text-thin">
                               <%= I18n.t('dashboard_effective') %> 
                            </h4>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-6 col-lg-6">
                    <div classs="panel panel-success panel-colorful text-center">
                        <div class="panel-body">

                        </div>
                        <div class="bg-light pad-ver">
                            <h4 class="mar-no text-thin">
                                <%= I18n.t('dashboard_effective') %> 
                            </h4>
                        </div>
                    </div>
                </div>
                <div class="col-sm-6 col-lg-6">
                    <div classs="panel panel-success panel-colorful text-center">
                        <div class="panel-body">

                        </div>
                        <div class="bg-light pad-ver">
                            <h4 class="mar-no text-thin">
                                <%= I18n.t('dashboard_effective') %> 
                            </h4>
                        </div>
                    </div>
                </div>
            </div>           
            </div>
        </div>
    </div>
</div-->

<script type="text/javascript">
   
   update_month_chart();
   update_today_chart();
   update_today_profit();
   update_today_performance();
   //update_week_profit_chart()

   function update_today_chart()
   {
        Morris.Donut({
            element: 'today-performance-chart',
            data: get_today_data(),
            colors: [
                '#c686be',
                '#986291',
                '#ab6fa3'
            ],
            resize:true
        });
   }

   function get_today_data(){

        today_data = $("#one_month_data").data("trades")[31];

        return [
            {"label" :"WON", "value" : today_data.total_won},
            {"label" :"TIE", "value" : today_data.total_tie},
            {"label" :"LOST", "value" : today_data.total_lost},
        ]
   }

    function update_today_profit(){

        today_data = $("#one_month_data").data("trades")[31];

        $("#lbl-today-profit-real").text(parseFloat(today_data.profit).toFixed(2));
    }

    function update_today_performance(){

        today_data = $("#one_month_data").data("trades")[31];

        today_trades = today_data.total_won + today_data.total_tie + today_data.total_lost;
        today_success = today_data.total_won + today_data.total_tie;
        today_performance = Math.round((today_success / today_trades) * 100);

        $("#lbl-today-performance").text(today_performance + " %");
    }

   function update_month_chart()
   {
        Morris.Area({
            element: 'month-performance-chart',
            data: $('#one_month_data').data('trades'),
            xkey: 'date',
            ykeys: ['total_won', 'total_tie', 'total_lost'],
            labels: ['WON', 'TIE', 'LOST'],
            //gridEnabled: false,
            //gridLineColor: 'transparent',
            behaveLikeLine: true,
            lineColors: ['#045d97'],
            pointSize: 0,
            pointStrokeColors : ['#045d97'],
            lineWidth: 0,
            resize:true,
            hideHover: 'auto',
            fillOpacity: 0.7,
            parseTime:false
        });
    }

    /*function update_week_profit_chart()
    {
        week_trades = $("#one_month_data").data("trades").slice( 26, 32 );
        week_profits = [];

        $.each(week_trades, function( index, value ) {
           week_profits.push(value.profit);
        });

        $("#week-profit-chart").sparkline(week_profits, {
            type: 'line',
            width: '110',
            height: '50',
            spotRadius: 2.5,
            lineWidth:1.5,
            lineColor:'#ffffff',
            fillColor: false,
            minSpotColor :false,
            maxSpotColor : false,
            highlightLineColor : '#ffffff',
            highlightSpotColor: '#ffffff',
            tooltipChartTitle: 'Earning',
            tooltipPrefix :'$ ',
            spotColor:'#ffffff',
            valueSpots : {
                '0:': '#ffffff'
            }
        });

    }*/


    /*$("#demo-sparkline-area").sparkline([57,69,70,68,73,76,75,79,73,76,77,73], {
        type: 'line',
        width: '110',
        height: '50',
        spotRadius: 2.5,
        lineWidth:1.5,
        lineColor:'rgba(255,255,255,.5)',
        fillColor: 'rgba(0,0,0,0.2)',
        spotColor: 'rgba(255,255,255,.5)',
        minSpotColor: 'rgba(255,255,255,.5)',
        maxSpotColor: 'rgba(255,255,255,.5)',
        highlightLineColor : '#ffffff',
        highlightSpotColor: '#ffffff',
        tooltipChartTitle: 'Usage',
        tooltipSuffix:' %'

    });


    // Visitor chart ( Sparkline chart )
    // =================================================================
    // Require Sparkline Chart
    // -----------------------------------------------------------------
    // http://omnipotent.net/jquery.sparkline/#s-about
    // =================================================================
    /*$("#demo-chart-visitors").sparkline([476,643,356,453,745,976,867,886,984,645,767,799], {
        type: 'line',
        width: '110',
        height: '22',
        spotRadius: 3,
        lineWidth:1,
        lineColor:'rgba(255,255,255,.9)',
        fillColor: 'rgba(0,0,0,0.05)',
        spotColor: 'rgba(255,255,255,.5)',
        minSpotColor: 'rgba(255,255,255,.5)',
        maxSpotColor: 'rgba(255,255,255,.5)',
        highlightLineColor : '#ffffff',
        highlightSpotColor: '#ffffff',
        tooltipChartTitle: 'Visitors',
        tooltipSuffix:' k',
    });*/





    // Bounce rate chart ( Sparkline chart )
    // =================================================================
    // Require Sparkline Chart
    // -----------------------------------------------------------------
    // http://omnipotent.net/jquery.sparkline/#s-about
    // =================================================================
    /*$("#demo-chart-bounce-rate").sparkline([23,24,22,27,35,40,39,29,27,33,29,37], {
        type: 'line',
        width: '110',
        height: '22',
        spotRadius: 3,
        lineWidth:1,
        lineColor:'rgba(255,255,255,.9)',
        fillColor: 'rgba(0,0,0,0.05)',
        spotColor: 'rgba(255,255,255,.5)',
        minSpotColor: 'rgba(255,255,255,.5)',
        maxSpotColor: 'rgba(255,255,255,.5)',
        highlightLineColor : '#ffffff',
        highlightSpotColor: '#ffffff',
        tooltipChartTitle: 'Bounce rate',
        tooltipSuffix:' %'

    });*/

    /*$(function () {

            var day_data = [
            {"elapsed": "2013 - 01", "value": 24, b:2},
            {"elapsed": "2013 - 02", "value": 34, b:22},
            {"elapsed": "2013 - 03", "value": 33, b:7},
            {"elapsed": "2013 - 04", "value": 22, b:6},
            {"elapsed": "2013 - 05", "value": 28, b:17},
            {"elapsed": "2013 - 06", "value": 60, b:15},
            {"elapsed": "2013 - 07", "value": 60, b:17},
            {"elapsed": "2013 - 08", "value": 70, b:7},
            {"elapsed": "2013 - 09", "value": 67, b:18},
            {"elapsed": "2013 - 10", "value": 86, b: 18},
            {"elapsed": "2013 - 11", "value": 86, b: 18},
            {"elapsed": "2013 - 12", "value": 113, b: 29},
            {"elapsed": "2014 - 01", "value": 130, b: 23},
            {"elapsed": "2014 - 02", "value": 114, b:10},
            {"elapsed": "2014 - 03", "value": 80, b:22},
            {"elapsed": "2014 - 04", "value": 109, b:7},
            {"elapsed": "2014 - 05", "value": 100, b:6},
            {"elapsed": "2014 - 06", "value": 105, b:17},
            {"elapsed": "2014 - 07", "value": 110, b:15},
            {"elapsed": "2014 - 08", "value": 102, b:17},
            {"elapsed": "2014 - 09", "value": 107, b:7},
            {"elapsed": "2014 - 10", "value": 60, b:18},
            {"elapsed": "2014 - 11", "value": 67, b: 18},
            {"elapsed": "2014 - 12", "value": 76, b: 18},
            {"elapsed": "2015 - 01", "value": 73, b: 29},
            {"elapsed": "2015 - 02", "value": 94, b: 13},
            {"elapsed": "2015 - 03", "value": 79, b: 24}
        ];

        var chart = Morris.Area({
            element: 'morris-chart-network',
            data: day_data,
            axes:false,
            xkey: 'elapsed',
            ykeys: ['value', 'b'],
            labels: ['Download Speed', 'Upload Speed'],
            yLabelFormat :function (y) { return y.toString() + ' Mb/s'; },
            gridEnabled: false,
            gridLineColor: 'transparent',
            lineColors: ['#8eb5e3','#1b72bc'],
            lineWidth:0,
            pointSize:0,
            pointFillColors:['#3e80bd'],
            pointStrokeColors:'#3e80bd',
            fillOpacity:.7,
            gridTextColor:'#999',
            parseTime: false,
            resize:true,
            behaveLikeLine : true,
            hideHover: 'auto'
        });

    });*/

    /*$(".dropdown").hover(            
            function() {
                $('.dropdown-menu', this).not('.in .dropdown-menu').stop( true, true ).slideDown("fast");
                $(this).toggleClass('open');        
            },
            function() {
                $('.dropdown-menu', this).not('.in .dropdown-menu').stop( true, true ).slideUp("fast");
                $(this).toggleClass('open');       
            }
        );*/
</script>